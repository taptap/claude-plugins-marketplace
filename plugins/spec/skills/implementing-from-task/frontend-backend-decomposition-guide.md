# 前后端分解指南

## 目标

帮助在 Spec-Driven Development (SDD) 流程的**阶段零**中,准确识别 PRD 中哪些需求属于前端、后端或协同任务，避免后端资源浪费在纯前端任务上。

## 识别原则

### 纯前端任务（后端无需关注）

**定义**：不涉及业务逻辑、数据存储、API 调用变更的 UI/UX 优化。

**特征**：
- ✅ 关键词：样式、布局、动画、交互、响应式、前端路由、前端状态管理
- ✅ 不涉及：API 接口变更、数据库操作、业务规则调整
- ✅ 前端独立完成：使用现有 API，只改变数据展示方式

**示例**：
| PRD 描述 | 任务类型 | 理由 |
|---------|---------|------|
| "评价列表页面新增筛选器，支持按时间/热度排序" | 纯前端 | 前端调用现有 API 传递排序参数，无需后端改动 |
| "动态详情页样式调整：头像尺寸从 40px 改为 48px" | 纯前端 | CSS 样式修改，无数据逻辑变更 |
| "用户资料页新增 Tab 切换动画效果" | 纯前端 | 前端动画实现，不涉及数据请求 |
| "移动端适配：评论列表在 < 768px 时改为单列布局" | 纯前端 | 响应式布局调整，无业务逻辑变更 |

### 纯后端任务（本技能重点）

**定义**：业务逻辑实现、数据存储、API 开发，前端只需调用新接口即可。

**特征**：
- ✅ 关键词：API 接口、业务规则、数据库、缓存、性能优化、定时任务、消息队列
- ✅ 涉及：Proto 定义、数据库 Schema、配置管理、服务间调用
- ✅ 前端依赖：需等待后端接口完成

**示例**：
| PRD 描述 | 任务类型 | 理由 |
|---------|---------|------|
| "评价内容支持自定义表情存储和渲染" | 纯后端 | 需修改 Proto 定义、数据库存储格式、渲染逻辑 |
| "新增表情收藏接口：POST /api/v1/emoji/collect" | 纯后端 | API 开发、业务逻辑实现、数据库操作 |
| "用户资料回调处理改为并发，提升性能" | 纯后端 | 后端性能优化，前端无感知 |
| "评价审核失败时，自动发送站内信通知用户" | 纯后端 | 定时任务、消息队列、通知逻辑 |

### 协同任务（需前后端配合）

**定义**：需要前后端同步修改，且存在依赖关系。

**特征**：
- ✅ 关键词：新增字段、权限控制、数据验证、实时通信
- ✅ 后端职责：定义 Proto、实现业务逻辑、返回数据
- ✅ 前端职责：解析新字段、展示 UI、处理用户交互
- ✅ 依赖关系：后端先完成 Proto 定义和接口实现，前端再对接

**示例**：
| PRD 描述 | 后端职责 | 前端职责 | 依赖关系 |
|---------|---------|---------|---------|
| "评价新增 custom_emoji 字段，支持自定义表情展示" | 1. Proto 新增 `custom_emoji` 字段<br>2. 存储逻辑实现<br>3. API 返回表情数据 | 1. 解析 `custom_emoji` 字段<br>2. 渲染表情图标<br>3. 点击交互处理 | 后端先完成 Proto 和 API，前端再对接 |
| "管理员可删除违规评论，普通用户无权限" | 1. 鉴权逻辑实现<br>2. Proto 新增 `can_delete` 字段<br>3. 删除接口返回权限状态 | 1. 根据 `can_delete` 显示/隐藏删除按钮<br>2. 调用删除接口<br>3. 展示权限错误提示 | 后端先实现鉴权，前端再对接 |
| "用户输入手机号时，后端验证格式并返回错误提示" | 1. 定义验证规则（如中国大陆手机号）<br>2. API 返回错误码和提示文案 | 1. 实时调用验证接口<br>2. 展示错误提示<br>3. 阻止表单提交 | 后端先定义验证规则，前端再对接 |

## 决策流程图

```
接收 PRD 中的某个需求
        ↓
   是否涉及 API 接口变更？
     ├── 否 → 是否涉及业务规则变更？
     │        ├── 否 → 纯前端任务
     │        └── 是 → 纯后端任务（如定时任务、后台脚本）
     └── 是 → 是否需要前端展示新数据？
              ├── 否 → 纯后端任务（如性能优化、数据迁移）
              └── 是 → 协同任务
```

## 实战示例

### 案例 1：评价支持自定义表情（来自真实 PRD）

**PRD 原文摘要**：
> 1. 评价列表页面新增筛选器 UI
> 2. 评价内容支持自定义表情存储和渲染
> 3. 新增表情收藏接口
> 4. 动态详情页样式调整：头像尺寸从 40px 改为 48px

**分解结果**：

| 需求 | 任务类型 | 理由 | 负责方 |
|------|---------|------|--------|
| 评价列表页面新增筛选器 UI | 纯前端 | 前端调用现有 API 传递筛选参数，无需后端改动 | 前端 |
| 评价内容支持自定义表情存储和渲染 | 协同任务 | 后端需修改 Proto 和存储逻辑，前端需解析并渲染表情 | 后端先完成 Proto，前端再对接 |
| 新增表情收藏接口 | 纯后端 | API 开发、业务逻辑、数据库操作，前端直接调用 | 后端 |
| 动态详情页样式调整 | 纯前端 | CSS 样式修改，无业务逻辑变更 | 前端 |

**后端应关注的需求**（仅 2 项）：
- ✅ 评价内容支持自定义表情存储和渲染（协同任务）
- ✅ 新增表情收藏接口（纯后端任务）

### 案例 2：用户资料审核优化

**PRD 原文摘要**：
> 1. 用户资料回调处理改为并发，提升性能
> 2. 资料审核页面新增"批量审核"按钮
> 3. 审核失败时，自动发送站内信通知用户

**分解结果**：

| 需求 | 任务类型 | 理由 | 负责方 |
|------|---------|------|--------|
| 用户资料回调处理改为并发 | 纯后端 | 后端性能优化，前端无感知 | 后端 |
| 资料审核页面新增"批量审核"按钮 | 协同任务 | 后端需提供批量审核接口，前端需实现批量选择和调用 | 后端先完成接口，前端再对接 |
| 审核失败时自动发送站内信 | 纯后端 | 消息队列、通知逻辑，前端无需改动 | 后端 |

**后端应关注的需求**（全部 3 项）：
- ✅ 用户资料回调处理改为并发（纯后端任务）
- ✅ 资料审核页面新增"批量审核"按钮（协同任务，后端先行）
- ✅ 审核失败时自动发送站内信（纯后端任务）

## 常见误判场景

### 误判 1：将前端验证视为纯前端任务

**错误示例**：
> PRD："用户输入手机号时，实时验证格式并提示"
> 错误判断：纯前端任务（前端正则验证）

**正确分析**：
- **协同任务**：前端只做初步格式验证（用户体验），后端需定义最终验证规则（业务安全）
- 后端职责：定义验证规则、返回错误码
- 前端职责：实时调用接口、展示提示

### 误判 2：将 Proto 字段新增视为纯后端任务

**错误示例**：
> PRD："评价新增 custom_emoji 字段"
> 错误判断：纯后端任务（只改 Proto）

**正确分析**：
- **协同任务**：后端新增字段后，前端必须解析并展示
- 后端职责：Proto 定义、数据存储、API 返回
- 前端职责：解析字段、渲染 UI、处理交互

### 误判 3：将 UI 交互视为纯前端任务

**错误示例**：
> PRD："点击评论的表情按钮，展示表情选择器"
> 错误判断：纯前端任务（前端组件实现）

**正确分析**：
- **需进一步判断**：
  - 如果表情数据来自前端静态资源 → 纯前端任务
  - 如果表情数据需从后端 API 获取（如用户收藏的表情） → 协同任务

## 检查清单

在阶段零完成后，确认以下问题：

- [ ] 是否已识别出所有纯前端任务？（后端无需关注）
- [ ] 是否已识别出所有纯后端任务？（前端只需调用接口）
- [ ] 是否已识别出所有协同任务？（明确前后端职责和依赖关系）
- [ ] 协同任务是否已标注依赖关系？（谁先做、谁后做）
- [ ] 是否已过滤掉后端无需关注的需求？（避免资源浪费）

## 参考资料

- **服务定位**：项目提供的服务发现工具或文档（帮助快速定位功能所属服务）
- **服务索引**：项目的服务索引文档（用于映射功能域到具体服务）
- **项目架构**：项目根目录的 README.md（记录架构和服务划分）
- **Spec 模板**：[spec-template.md](spec-template.md)
