# Spec 模板

## 文件路径

`specs/TAP-{任务ID}/spec.md`

## 模板内容

```markdown
# {任务工单标题}

## 概述

{从 PRD 提取的功能概述}

## 任务工单

- 工单: [TAP-{任务ID}](https://project.feishu.cn/pojq34/story/detail/{任务ID})
- PRD: [{PRD 文档标题}]({PRD 链接})

## 影响范围分析

### 前后端职责划分

**纯后端任务**（本次实现重点）：
- {后端任务 1}
- {后端任务 2}

**协同任务**（需前端配合）：
- {协同任务 1}：后端负责 {XXX}，前端负责 {YYY}
- {协同任务 2}：后端负责 {XXX}，前端负责 {YYY}

**纯前端任务**（后端无需关注）：
- {前端任务 1}
- {前端任务 2}

### 涉及服务及定位依据

#### 服务 1：{服务名称}

- **路径**：`app/{服务目录}/`
- **选择原因**：
  - 关键词匹配：PRD 中提到 "{关键词}" → service-index.md 映射到此服务
  - 功能域匹配：属于 "{功能域分类}"（如：内容发布与互动、用户与社交）
  - Proto 验证：`proto/taptap/{路径}/*.proto` 包含相关定义
- **现有代码**：
  - `internal/service/{文件}.go` - {功能说明}
  - `internal/repo/{文件}.go` - {功能说明}
- **Proto 定义**：`proto/taptap/{路径}/v1/{文件}.proto`

#### 服务 2：{服务名称}

{同上结构}

### 变更影响评估

#### Proto 变更

- **是否变更**：{是/否}
- **影响范围**：
  - 新增/修改字段：`{proto 文件路径}` 中的 `{message 名称}.{字段名称}`
  - 影响服务：{服务 A}（消费方）、{服务 B}（生产方）
  - 兼容性：{向后兼容/需协调升级}

#### 数据库变更

- **是否变更**：{是/否}
- **涉及表**：
  - `{数据库名}.{表名}`：{新增/修改/删除} {字段/索引}
  - 数据迁移：{需要/不需要}，{迁移策略说明}
- **性能影响**：{评估查询性能变化}

#### 配置变更

- **Apollo 配置**：
  - `{namespace}`：新增/修改 `{配置项}` = `{默认值}`
  - 影响环境：{dev/test/prod}
- **Kubernetes 配置**：
  - 资源调整：{CPU/内存/副本数}
  - 环境变量：{新增/修改}

## 功能需求

### 业务需求

{从 PRD 提取的业务需求}

### 技术需求

{后端技术实现要求}

## API 设计

### 接口列表

| 方法 | 路径 | 描述 |
|------|------|------|
| POST | /api/v1/xxx | 描述 |

### 请求/响应示例

{API 详细设计}

## 数据模型

### 新增/修改的表

{数据库变更}

### Proto 定义

{如有 Proto 变更}

## 实现约束

- 性能要求
- 安全要求
- 兼容性要求

## 验收标准

- [ ] 功能测试通过
- [ ] 单元测试覆盖
- [ ] 代码审查通过
```

## 使用说明

1. **影响范围分析**（新增章节）：
   - 前后端职责划分：使用 [前后端分解指南](前后端分解指南.md) 识别任务类型
   - 涉及服务定位：参考 [service-index.md](../../../../skills/service-discovery/service-index.md) 和 [README.md](../../../../README.md)
   - 变更影响评估：分析 Proto/数据库/配置变更的连锁影响

2. **功能需求**：根据 PRD 内容填充，只包含后端相关内容

3. **API 设计**：明确请求/响应格式，遵循 [protobuf-api-conventions.mdc](../../../../.cursor/rules/protobuf-api-conventions.mdc)

4. **保持简洁**：避免重复 PRD 内容，专注后端技术实现要点
